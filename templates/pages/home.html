{% extends 'layouts/base.html' %}

{% block headtitle %}
Pages
{% endblock %}

{% block content %}

<div class='row'>
      <div class='col'>
            <h1 class=''>DJRT App</h1>
      </div>
</div>

<div class='row' id='tweetsDiv'></div>


<script type='text/javascript'>

      const xhr = new XMLHttpRequest()
      const method = 'GET'
      const url = "/tweets"
      const responseType = "json"
      
      var finalTweetsStr = ""
      var i=0;
      
      function handleDidLike(tweet_id, currentCount){
            console.log("HANDLE LIKE", tweet_id, currentCount)
      }


      function formatTweetElement(tweet) {
            var tweetHTML = `
                  <div class='col-12 col-md-12 mx-auto border rounded py-3 mb-4' id='div-tweet-${tweet.id}'>      
                        <p> ${tweet.id}. ${tweet.content} </p>
                        <div class='btn-group'>${LikeBtn(tweet)}</div>
                  </div>`
            return tweetHTML
      }

      function LikeBtn(tweet){
            return `<button class='btn btn-primary btn-sm' id='like-tweet-${tweet.id}' onclick=handleDidLike(${tweet.id},${tweet.likes})>${tweet.likes} Likes</button>`
      }


      xhr.responseType = responseType
      xhr.open(method, url)
      xhr.onload = function(){
            const serverResponse = xhr.response
            var listedItems = serverResponse.data     

            for (i=0; i < listedItems.length; i++){
                  var currentItem = listedItems[i]
                  var tweetObjHTML = formatTweetElement(currentItem)
                  finalTweetsStr += tweetObjHTML
            }

            tweetsDivElement.innerHTML = finalTweetsStr
      }
      xhr.send()

      const tweetsDivElement = document.getElementById("tweetsDiv")
      tweetsDivElement.innerHTML = "Loading ..."

</script>

{% endblock %}
